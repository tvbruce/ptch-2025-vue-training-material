<template>
  <div class="self-challenge">
    <h2>ğŸ¯ è‡ªæˆ‘è©¦ç…‰ - Lifecycle ç”Ÿå‘½é€±æœŸ</h2>
    <p class="route-info">ğŸ“ è·¯å¾‘ï¼š/LifecycleSamples/SelfChallengeDemo.vue</p>
    <p class="description">
      ğŸ“ <strong>æŒ‘æˆ°ä»»å‹™ï¼š</strong>ç·´ç¿’ Vue3 ç”Ÿå‘½é€±æœŸé‰¤å­çš„åŸºæœ¬ç”¨æ³•
    </p>

    <!-- ä»»å‹™èªªæ˜å€å¡Š -->
    <div class="task-instructions">
      <h3>ğŸ“‹ å­¸å“¡ä»»å‹™æ¸…å–®</h3>
      <div class="instruction-card">
        <h4>ğŸ¯ ä»»å‹™ä¸€ï¼šå¯¦ä½œåŸºæœ¬è¨ˆæ™‚å™¨ (onMounted & onUnmounted)</h4>
        <div class="task-details">
          <p><strong>ç›®æ¨™ï¼š</strong>ç·´ç¿’çµ„ä»¶æ›è¼‰å’Œå¸è¼‰æ™‚çš„è³‡æºç®¡ç†</p>
          <ul>
            <li><strong>åœ¨ onMounted ä¸­ï¼š</strong>å•Ÿå‹•ä¸€å€‹æ¯ç§’æ›´æ–°çš„è¨ˆæ™‚å™¨</li>
            <li><strong>åœ¨ onUnmounted ä¸­ï¼š</strong>æ¸…ç†è¨ˆæ™‚å™¨ï¼Œé¿å…è¨˜æ†¶é«”æ´©æ¼</li>
            <li><strong>å¯¦ä½œ formatTime() å‡½æ•¸ï¼š</strong>å°‡ç§’æ•¸è½‰æ›ç‚º "mm:ss" æ ¼å¼</li>
            <li><strong>å¯¦ä½œ toggleTimer() å‡½æ•¸ï¼š</strong>æ§åˆ¶è¨ˆæ™‚å™¨çš„é–‹å§‹å’Œæš«åœ</li>
          </ul>
          <div class="logic-spec">
            <strong>é‚è¼¯è¦æ ¼ï¼š</strong>
            <pre>formatTime(90) â†’ "01:30"
toggleTimer() â†’ å¦‚æœæ­£åœ¨é‹è¡Œå‰‡æš«åœï¼Œå¦å‰‡é–‹å§‹</pre>
          </div>
        </div>
      </div>

      <div class="instruction-card">
        <h4>ğŸ¯ ä»»å‹™äºŒï¼šçµ„ä»¶æ›´æ–°ç›£æ§ (onUpdated)</h4>
        <div class="task-details">
          <p><strong>ç›®æ¨™ï¼š</strong>å­¸ç¿’ç›£æ§çµ„ä»¶çš„æ›´æ–°è¡Œç‚º</p>
          <ul>
            <li><strong>åœ¨ onUpdated ä¸­ï¼š</strong>æ¯æ¬¡çµ„ä»¶æ›´æ–°æ™‚å¢åŠ è¨ˆæ•¸å™¨</li>
            <li><strong>å¯¦ä½œ incrementCounter() å‡½æ•¸ï¼š</strong>æ‰‹å‹•è§¸ç™¼è¨ˆæ•¸å™¨å¢åŠ </li>
            <li><strong>è§€å¯Ÿæ›´æ–°è¡Œç‚ºï¼š</strong>äº†è§£ä»€éº¼æ“ä½œæœƒè§¸ç™¼çµ„ä»¶æ›´æ–°</li>
          </ul>
          <div class="logic-spec">
            <strong>é‚è¼¯è¦æ ¼ï¼š</strong>
            <pre>æ¯æ¬¡çµ„ä»¶é‡æ–°æ¸²æŸ“ â†’ updateCount è‡ªå‹• +1
é»æ“ŠæŒ‰éˆ• â†’ counter æ‰‹å‹• +1</pre>
          </div>
        </div>
      </div>

      <div class="instruction-card">
        <h4>ğŸ¯ ä»»å‹™ä¸‰ï¼šæ¨¡æ“¬æ•¸æ“šè¼‰å…¥</h4>
        <div class="task-details">
          <p><strong>ç›®æ¨™ï¼š</strong>çµåˆç”Ÿå‘½é€±æœŸå’Œç•°æ­¥æ“ä½œ</p>
          <ul>
            <li><strong>å¯¦ä½œ loadUserData() å‡½æ•¸ï¼š</strong>æ¨¡æ“¬ API æ•¸æ“šè¼‰å…¥</li>
            <li><strong>è™•ç†è¼‰å…¥ç‹€æ…‹ï¼š</strong>é¡¯ç¤ºè¼‰å…¥ä¸­ã€æˆåŠŸã€å¤±æ•—ç‹€æ…‹</li>
            <li><strong>åœ¨é©ç•¶æ™‚æ©Ÿï¼š</strong>é¸æ“‡åœ¨ onMounted æˆ–æ‰‹å‹•è§¸ç™¼è¼‰å…¥</li>
          </ul>
          <div class="logic-spec">
            <strong>é‚è¼¯è¦æ ¼ï¼š</strong>
            <pre>è¼‰å…¥ä¸­ â†’ loading = true, é¡¯ç¤ºè¼‰å…¥æç¤º
2ç§’å¾Œ â†’ è¿”å›æ¨¡æ“¬ç”¨æˆ¶æ•¸æ“š
è¼‰å…¥å®Œæˆ â†’ loading = false, é¡¯ç¤ºæ•¸æ“š</pre>
          </div>
        </div>
      </div>
    </div>

    <!-- å¯¦ä½œå€åŸŸ -->
    <div class="demo-section">
      <h3>â° ä»»å‹™ä¸€ï¼šåŸºæœ¬è¨ˆæ™‚å™¨</h3>
      <div class="timer-section">
        <div class="timer-display">
          <h4>é‹è¡Œæ™‚é–“ï¼š{{ formatTime(elapsedTime) }}</h4>
          <p>ç‹€æ…‹ï¼š{{ isRunning ? 'ğŸŸ¢ é‹è¡Œä¸­' : 'ğŸ”´ å·²æš«åœ' }}</p>
        </div>
        <div class="timer-controls">
          <!-- TODO: é€£æ¥ toggleTimer å‡½æ•¸ -->
          <button @click="toggleTimer" class="btn btn-primary">
            {{ isRunning ? 'â¸ï¸ æš«åœ' : 'â–¶ï¸ é–‹å§‹' }}
          </button>
        </div>
      </div>
    </div>

    <div class="demo-section">
      <h3>ğŸ“Š ä»»å‹™äºŒï¼šæ›´æ–°ç›£æ§</h3>
      <div class="update-section">
        <div class="counter-display">
          <p>æ‰‹å‹•è¨ˆæ•¸å™¨ï¼š<span class="counter-value">{{ counter }}</span></p>
          <p>çµ„ä»¶æ›´æ–°æ¬¡æ•¸ï¼š<span class="update-value">{{ updateCount }}</span></p>
        </div>
        <div class="update-controls">
          <!-- TODO: å¯¦ä½œ incrementCounter å‡½æ•¸ -->
          <button @click="incrementCounter" class="btn btn-success">
            ğŸ”¢ å¢åŠ è¨ˆæ•¸å™¨
          </button>
          <small class="help-text">é»æ“ŠæŒ‰éˆ•è§€å¯Ÿçµ„ä»¶æ›´æ–°è¡Œç‚º</small>
        </div>
      </div>
    </div>

    <div class="demo-section">
      <h3>ğŸ“¡ ä»»å‹™ä¸‰ï¼šæ•¸æ“šè¼‰å…¥</h3>
      <div class="data-section">
        <div class="loading-controls">
          <!-- TODO: å¯¦ä½œ loadUserData å‡½æ•¸ -->
          <button @click="loadUserData" class="btn btn-info" :disabled="loading">
            {{ loading ? 'ğŸ“¡ è¼‰å…¥ä¸­...' : 'ğŸ”„ è¼‰å…¥ç”¨æˆ¶æ•¸æ“š' }}
          </button>
        </div>

        <div v-if="loading" class="loading-status">
          <div class="loading-spinner">â³ æ­£åœ¨è¼‰å…¥æ•¸æ“š...</div>
        </div>

        <div v-if="!loading && userData.length > 0" class="user-data">
          <h4>ğŸ‘¥ ç”¨æˆ¶åˆ—è¡¨ï¼š</h4>
          <div class="user-list">
            <div v-for="user in userData" :key="user.id" class="user-item">
              {{ user.name }} ({{ user.email }})
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="status-section">
      <h3>ğŸ” çµ„ä»¶ç‹€æ…‹ç›£æ§</h3>
      <div class="status-grid">
        <div class="status-item">
          <strong>è¨ˆæ™‚å™¨ï¼š</strong>
          <span :class="{ active: isRunning }">{{ isRunning ? 'é‹è¡Œä¸­' : 'å·²åœæ­¢' }}</span>
        </div>
        <div class="status-item">
          <strong>æ›´æ–°æ¬¡æ•¸ï¼š</strong>
          <span>{{ updateCount }} æ¬¡</span>
        </div>
        <div class="status-item">
          <strong>æ•¸æ“šç‹€æ…‹ï¼š</strong>
          <span>{{ loading ? 'è¼‰å…¥ä¸­' : userData.length > 0 ? 'å·²è¼‰å…¥' : 'æœªè¼‰å…¥' }}</span>
        </div>
      </div>
    </div>

    <div class="hint-section">
      <h4>ğŸ’¡ å¯¦ä½œæç¤º</h4>
      <details>
        <summary>é»æ“ŠæŸ¥çœ‹ç”Ÿå‘½é€±æœŸé‰¤å­ç”¨æ³•</summary>
        <pre><code>// 1. åŒ¯å…¥ç”Ÿå‘½é€±æœŸé‰¤å­
import { onMounted, onUnmounted, onUpdated } from 'vue'

// 2. åœ¨ onMounted ä¸­åˆå§‹åŒ–
onMounted(() => {
  console.log('çµ„ä»¶å·²æ›è¼‰')
  // å•Ÿå‹•è¨ˆæ™‚å™¨çš„ç¨‹å¼ç¢¼...
})

// 3. åœ¨ onUnmounted ä¸­æ¸…ç†
onUnmounted(() => {
  console.log('çµ„ä»¶å³å°‡å¸è¼‰')
  // æ¸…ç†è¨ˆæ™‚å™¨çš„ç¨‹å¼ç¢¼...
})

// 4. åœ¨ onUpdated ä¸­ç›£æ§æ›´æ–°
onUpdated(() => {
  console.log('çµ„ä»¶å·²æ›´æ–°')
  // æ›´æ–°è¨ˆæ•¸çš„ç¨‹å¼ç¢¼...
})</code></pre>
      </details>

      <details>
        <summary>é»æ“ŠæŸ¥çœ‹å‡½æ•¸å¯¦ä½œæç¤º</summary>
        <pre><code>// formatTime å¯¦ä½œæç¤º
const formatTime = (seconds) => {
  const mins = Math.floor(seconds / 60)
  const secs = seconds % 60
  // å›å‚³æ ¼å¼åŒ–å­—ä¸²...
}

// è¨ˆæ™‚å™¨æ§åˆ¶æç¤º
const toggleTimer = () => {
  if (isRunning.value) {
    // åœæ­¢è¨ˆæ™‚å™¨...
  } else {
    // å•Ÿå‹•è¨ˆæ™‚å™¨...
  }
}

// æ•¸æ“šè¼‰å…¥æç¤º
const loadUserData = async () => {
  loading.value = true
  // æ¨¡æ“¬ API å»¶é²...
  // è¨­å®šæ¨¡æ“¬æ•¸æ“š...
  loading.value = false
}</code></pre>
      </details>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted, onUnmounted, onUpdated } from 'vue'

// ä»»å‹™ä¸€ï¼šè¨ˆæ™‚å™¨ç›¸é—œ
const elapsedTime = ref(0)
const isRunning = ref(false)
// eslint-disable-next-line no-unused-vars
const timer = ref(null)

// ä»»å‹™äºŒï¼šæ›´æ–°ç›£æ§ç›¸é—œ
const counter = ref(0)
const updateCount = ref(0)

// ä»»å‹™ä¸‰ï¼šæ•¸æ“šè¼‰å…¥ç›¸é—œ
const userData = ref([])
const loading = ref(false)

// TODO: å­¸å“¡éœ€è¦å¯¦ä½œä»¥ä¸‹å‡½æ•¸

// ä»»å‹™ä¸€ï¼šæ ¼å¼åŒ–æ™‚é–“é¡¯ç¤º (ä¾‹ï¼š90ç§’ â†’ "01:30")
const formatTime = () => {
  // è«‹åœ¨é€™è£¡å¯¦ä½œæ™‚é–“æ ¼å¼åŒ–é‚è¼¯
  // æç¤ºï¼šä½¿ç”¨ Math.floor å’Œ % é‹ç®—ç¬¦ï¼Œåƒæ•¸ç‚º elapsedTime.value
  return '00:00'
}

// ä»»å‹™ä¸€ï¼šåˆ‡æ›è¨ˆæ™‚å™¨ç‹€æ…‹
const toggleTimer = () => {
  // è«‹åœ¨é€™è£¡å¯¦ä½œè¨ˆæ™‚å™¨é–‹å§‹/æš«åœé‚è¼¯
  // æç¤ºï¼šä½¿ç”¨ setInterval å’Œ clearInterval
}

// ä»»å‹™äºŒï¼šå¢åŠ æ‰‹å‹•è¨ˆæ•¸å™¨
const incrementCounter = () => {
  // è«‹åœ¨é€™è£¡å¯¦ä½œè¨ˆæ•¸å™¨å¢åŠ é‚è¼¯
  // æç¤ºï¼šé€™æœƒè§¸ç™¼çµ„ä»¶æ›´æ–°
}

// ä»»å‹™ä¸‰ï¼šè¼‰å…¥ç”¨æˆ¶æ•¸æ“š
const loadUserData = async () => {
  // è«‹åœ¨é€™è£¡å¯¦ä½œæ•¸æ“šè¼‰å…¥é‚è¼¯
  // æç¤ºï¼šè¨­å®š loading ç‹€æ…‹ï¼Œä½¿ç”¨ setTimeout æ¨¡æ“¬å»¶é²
  // æ¨¡æ“¬æ•¸æ“šçµæ§‹ï¼š[{ id: 1, name: 'å¼µä¸‰', email: 'zhang@example.com' }]
}

// TODO: å­¸å“¡éœ€è¦å¯¦ä½œä»¥ä¸‹ç”Ÿå‘½é€±æœŸé‰¤å­

onMounted(() => {
  // è«‹åœ¨é€™è£¡å¯¦ä½œçµ„ä»¶æ›è¼‰å¾Œçš„é‚è¼¯
  // ä»»å‹™ï¼šå¯ä»¥é¸æ“‡è‡ªå‹•å•Ÿå‹•è¨ˆæ™‚å™¨æˆ–è¼‰å…¥æ•¸æ“š
})

onUnmounted(() => {
  // è«‹åœ¨é€™è£¡å¯¦ä½œçµ„ä»¶å¸è¼‰å‰çš„æ¸…ç†é‚è¼¯
  // ä»»å‹™ï¼šæ¸…ç†è¨ˆæ™‚å™¨ï¼Œé¿å…è¨˜æ†¶é«”æ´©æ¼
})

onUpdated(() => {
  // è«‹åœ¨é€™è£¡å¯¦ä½œçµ„ä»¶æ›´æ–°å¾Œçš„é‚è¼¯
  // ä»»å‹™ï¼šå¢åŠ æ›´æ–°è¨ˆæ•¸å™¨
})
</script>

<style scoped>
.self-challenge {
  max-width: 1000px;
  margin: 0 auto;
  padding: 2rem;
}

.route-info {
  background: #e3f2fd;
  padding: 0.5rem 1rem;
  border-radius: 4px;
  margin: 1rem 0;
  font-family: monospace;
}

.description {
  font-size: 1.1rem;
  margin: 1.5rem 0;
}

.task-instructions {
  background: #fff8e1;
  padding: 1.5rem;
  border-radius: 8px;
  margin: 2rem 0;
  border-left: 4px solid #ffc107;
}

.instruction-card {
  background: white;
  margin: 1rem 0;
  padding: 1.5rem;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.instruction-card h4 {
  color: #1976d2;
  margin-bottom: 1rem;
}

.task-details ul {
  margin: 1rem 0;
  padding-left: 1.5rem;
}

.task-details li {
  margin: 0.5rem 0;
  line-height: 1.6;
}

.logic-spec {
  background: #f5f5f5;
  padding: 1rem;
  border-radius: 4px;
  margin-top: 1rem;
}

.logic-spec pre {
  margin: 0.5rem 0 0 0;
  font-size: 0.9rem;
  color: #2e7d32;
}

.demo-section {
  margin: 2rem 0;
  padding: 1.5rem;
  border: 1px solid #ddd;
  border-radius: 8px;
  background: #fafafa;
}

.timer-section,
.update-section,
.data-section {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.timer-display,
.counter-display {
  background: white;
  padding: 1rem;
  border-radius: 8px;
  border: 1px solid #e0e0e0;
}

.timer-display h4 {
  font-size: 1.5rem;
  color: #1976d2;
  margin: 0.5rem 0;
}

.counter-value,
.update-value {
  font-size: 1.2rem;
  font-weight: bold;
  color: #4caf50;
}

.timer-controls,
.update-controls,
.loading-controls {
  display: flex;
  gap: 1rem;
  align-items: center;
}

.help-text {
  color: #666;
  font-style: italic;
}

.loading-status {
  text-align: center;
  padding: 2rem;
}

.loading-spinner {
  font-size: 1.2rem;
  color: #ff9800;
  animation: pulse 1.5s ease-in-out infinite alternate;
}

@keyframes pulse {
  from {
    opacity: 1;
  }

  to {
    opacity: 0.5;
  }
}

.user-data {
  background: white;
  padding: 1rem;
  border-radius: 8px;
  border: 1px solid #e0e0e0;
}

.user-list {
  margin-top: 1rem;
}

.user-item {
  padding: 0.5rem;
  background: #f8f9fa;
  margin: 0.5rem 0;
  border-radius: 4px;
  border-left: 3px solid #4caf50;
}

.status-section {
  background: #e8f5e8;
  padding: 1.5rem;
  border-radius: 8px;
  margin: 2rem 0;
}

.status-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-top: 1rem;
}

.status-item {
  background: white;
  padding: 1rem;
  border-radius: 8px;
  border: 1px solid #c8e6c9;
}

.status-item .active {
  color: #4caf50;
  font-weight: bold;
}

.btn {
  padding: 0.6rem 1.2rem;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.9rem;
  font-weight: 500;
  transition: all 0.2s;
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.btn-primary {
  background: #1976d2;
  color: white;
}

.btn-success {
  background: #4caf50;
  color: white;
}

.btn-info {
  background: #00bcd4;
  color: white;
}

.btn:hover:not(:disabled) {
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.hint-section {
  background: #e8f5e8;
  padding: 1.5rem;
  border-radius: 8px;
  margin: 2rem 0;
}

details {
  margin: 1rem 0;
}

summary {
  cursor: pointer;
  font-weight: bold;
  padding: 0.8rem;
  background: #c8e6c9;
  border-radius: 4px;
  transition: background-color 0.2s;
}

summary:hover {
  background: #a5d6a7;
}

pre {
  background: #2d3748;
  color: #e2e8f0;
  padding: 1rem;
  border-radius: 4px;
  overflow-x: auto;
  margin-top: 1rem;
  line-height: 1.5;
}
</style>
