<template>
    <div class="self-challenge-solution">
        <h2>âœ… è‡ªæˆ‘è©¦ç…‰è§£ç­” - Reactivity éŸ¿æ‡‰å¼</h2>
        <p class="route-info">ğŸ“ è·¯å¾‘ï¼š/ReactivitySamples/SelfChallengeSolution.vue</p>
        <p class="description">
            ğŸ“ <strong>è§£ç­”ç‰ˆæœ¬ï¼š</strong>å®Œæ•´å¯¦ç¾ Vue 3 éŸ¿æ‡‰å¼ç³»çµ±çš„å„ç¨®åŠŸèƒ½
        </p>

        <!-- ä»»å‹™ç‹€æ…‹ -->
        <div class="task-status">
            <h3>ğŸ¯ å®Œæˆç‹€æ…‹</h3>
            <div class="completed-tasks">
                <span class="task-badge completed">âœ… åŸºæœ¬ ref éŸ¿æ‡‰å¼è®Šæ•¸</span>
                <span class="task-badge completed">âœ… reactive ç‰©ä»¶éŸ¿æ‡‰å¼</span>
                <span class="task-badge completed">âœ… æ·±å±¤éŸ¿æ‡‰å¼é‹ä½œ</span>
                <span class="task-badge completed">âœ… computed éŸ¿æ‡‰å¼è¨ˆç®—</span>
                <span class="task-badge completed">âœ… éŸ¿æ‡‰å¼é™£åˆ—æ“ä½œ</span>
                <span class="task-badge completed">âœ… ç”¨æˆ¶è³‡æ–™ç®¡ç†ç³»çµ±</span>
            </div>
        </div>

        <!-- åŠŸèƒ½å±•ç¤ºå€åŸŸ -->
        <div class="demo-section">
            <h3>ğŸ¬ åŠŸèƒ½å±•ç¤º</h3>

            <!-- åŸºæœ¬ ref è®Šæ•¸ -->
            <div class="demo-card">
                <h4>1. åŸºæœ¬ ref éŸ¿æ‡‰å¼è®Šæ•¸</h4>
                <div class="demo-content">
                    <p><strong>å§“åï¼š</strong>{{ name }}</p>
                    <p><strong>å¹´é½¡ï¼š</strong>{{ age }}</p>
                    <p><strong>æ˜¯å¦ç‚ºå­¸ç”Ÿï¼š</strong>{{ isStudent ? 'æ˜¯' : 'å¦' }}</p>
                    <p><strong>èˆˆè¶£ï¼š</strong>{{ hobbies.join(', ') }}</p>

                    <div class="controls">
                        <input v-model="name" placeholder="ä¿®æ”¹å§“å" />
                        <input v-model.number="age" type="number" placeholder="ä¿®æ”¹å¹´é½¡" />
                        <label>
                            <input type="checkbox" v-model="isStudent" />
                            å­¸ç”Ÿèº«åˆ†
                        </label>
                        <button @click="addHobby">æ–°å¢èˆˆè¶£</button>
                    </div>
                </div>
            </div>

            <!-- reactive ç‰©ä»¶ -->
            <div class="demo-card">
                <h4>2. Reactive ç‰©ä»¶éŸ¿æ‡‰å¼</h4>
                <div class="demo-content">
                    <div class="user-profile">
                        <h5>ç”¨æˆ¶è³‡æ–™</h5>
                        <p><strong>å§“åï¼š</strong>{{ userProfile.name }}</p>
                        <p><strong>ä¿¡ç®±ï¼š</strong>{{ userProfile.email }}</p>
                        <p><strong>é ­åƒï¼š</strong>{{ userProfile.avatar }}</p>
                    </div>

                    <div class="user-settings">
                        <h5>ç³»çµ±è¨­å®š</h5>
                        <p><strong>ä¸»é¡Œï¼š</strong>{{ settings.theme }}</p>
                        <p><strong>èªè¨€ï¼š</strong>{{ settings.language }}</p>
                        <p><strong>é€šçŸ¥ï¼š</strong>{{ settings.notifications ? 'é–‹å•Ÿ' : 'é—œé–‰' }}</p>
                    </div>

                    <div class="user-stats">
                        <h5>çµ±è¨ˆè³‡è¨Š</h5>
                        <p><strong>ç™»å…¥æ¬¡æ•¸ï¼š</strong>{{ stats.loginCount }}</p>
                        <p><strong>æœ€å¾Œç™»å…¥ï¼š</strong>{{ stats.lastLoginTime }}</p>
                        <p><strong>åˆ†æ•¸ï¼š</strong>{{ stats.score }}</p>
                    </div>

                    <div class="controls">
                        <input v-model="userProfile.name" placeholder="ç”¨æˆ¶åç¨±" />
                        <input v-model="userProfile.email" placeholder="é›»å­ä¿¡ç®±" />
                        <select v-model="settings.theme">
                            <option value="light">æ·ºè‰²ä¸»é¡Œ</option>
                            <option value="dark">æ·±è‰²ä¸»é¡Œ</option>
                        </select>
                        <label>
                            <input type="checkbox" v-model="settings.notifications" />
                            é–‹å•Ÿé€šçŸ¥
                        </label>
                        <button @click="updateStats">æ›´æ–°çµ±è¨ˆ</button>
                    </div>
                </div>
            </div>

            <!-- ç”¨æˆ¶åç¨±æ›´æ–° -->
            <div class="demo-card">
                <h4>3. ç”¨æˆ¶åç¨±æ›´æ–°åŠŸèƒ½</h4>
                <div class="demo-content">
                    <p><strong>ç•¶å‰åç¨±ï¼š</strong>{{ name }} / {{ userProfile.name }}</p>
                    <div class="controls">
                        <input v-model="newUserName" placeholder="è¼¸å…¥æ–°åç¨±" />
                        <button @click="updateUserName(newUserName)">æ›´æ–°åç¨±</button>
                    </div>
                    <div v-if="updateMessage" class="message">{{ updateMessage }}</div>
                </div>
            </div>

            <!-- è¨ˆç®—å±¬æ€§å±•ç¤º -->
            <div class="demo-card">
                <h4>4. è¨ˆç®—å±¬æ€§ - ç”¨æˆ¶é¡¯ç¤ºåç¨±</h4>
                <div class="demo-content">
                    <p class="display-name">{{ userDisplayName }}</p>
                    <p class="description">é€™å€‹é¡¯ç¤ºåç¨±æœƒæ ¹æ“šå§“åã€å¹´é½¡å’Œå­¸ç”Ÿèº«åˆ†è‡ªå‹•æ›´æ–°</p>
                </div>
            </div>

            <!-- éŸ¿æ‡‰å¼é™£åˆ—æ“ä½œ -->
            <div class="demo-card">
                <h4>5. éŸ¿æ‡‰å¼é™£åˆ—æ“ä½œ</h4>
                <div class="demo-content">
                    <p><strong>èˆˆè¶£åˆ—è¡¨ï¼š</strong></p>
                    <ul>
                        <li v-for="(hobby, index) in hobbies" :key="index">
                            {{ hobby }}
                            <button @click="removeHobby(index)">ç§»é™¤</button>
                        </li>
                    </ul>
                    <div class="controls">
                        <input v-model="newHobby" placeholder="æ–°å¢èˆˆè¶£" @keyup.enter="addNewHobby" />
                        <button @click="addNewHobby">æ–°å¢</button>
                        <button @click="clearHobbies">æ¸…ç©ºå…¨éƒ¨</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<script setup>
import { ref, reactive, computed } from 'vue'

// 1. åŸºæœ¬ ref è®Šæ•¸
const name = ref('å°æ˜')
const age = ref(25)
const isStudent = ref(true)
const hobbies = ref(['è®€æ›¸', 'é‹å‹•'])

// 2. reactive ç‰©ä»¶
const userProfile = reactive({
    name: 'å°æ˜',
    email: 'xiaoming@example.com',
    avatar: 'https://i.pravatar.cc/150?u=xiaoming'
})

const settings = reactive({
    theme: 'light',
    language: 'zh-TW',
    notifications: true
})

const stats = reactive({
    loginCount: 12,
    lastLoginTime: new Date().toLocaleString(),
    score: 85
})

// è¼”åŠ©è®Šæ•¸
const newUserName = ref('')
const updateMessage = ref('')
const newHobby = ref('')

// 3. updateUserName(newName) å‡½æ•¸
const updateUserName = (newName) => {
    // é©—è­‰åç¨±
    if (!newName || newName.trim().length < 2 || newName.trim().length > 20) {
        updateMessage.value = 'åç¨±é•·åº¦éœ€åœ¨ 2-20 å­—å…ƒä¹‹é–“'
        setTimeout(() => updateMessage.value = '', 3000)
        return
    }

    // æ›´æ–° ref å’Œ reactive
    name.value = newName.trim()
    userProfile.name = newName.trim()

    // æ›´æ–°æ™‚é–“æˆ³
    stats.lastLoginTime = new Date().toLocaleString()

    updateMessage.value = 'ç”¨æˆ¶åç¨±æ›´æ–°æˆåŠŸï¼'
    newUserName.value = ''
    setTimeout(() => updateMessage.value = '', 3000)
}

// 4. userDisplayName è¨ˆç®—å±¬æ€§
const userDisplayName = computed(() => {
    let displayName = `${name.value} (${age.value}æ­²)`
    if (isStudent.value) {
        displayName += ' (å­¸ç”Ÿ)'
    }
    return displayName
})

// é™£åˆ—æ“ä½œå‡½æ•¸
const addHobby = () => {
    const newHobby = `èˆˆè¶£${hobbies.value.length + 1}`
    hobbies.value.push(newHobby)
}

const addNewHobby = () => {
    if (newHobby.value.trim()) {
        hobbies.value.push(newHobby.value.trim())
        newHobby.value = ''
    }
}

const removeHobby = (index) => {
    hobbies.value.splice(index, 1)
}

const clearHobbies = () => {
    hobbies.value = []
}

// æ›´æ–°çµ±è¨ˆå‡½æ•¸
const updateStats = () => {
    stats.loginCount++
    stats.score = Math.min(stats.score + 5, 100)
    stats.lastLoginTime = new Date().toLocaleString()
}
</script>

<style scoped>
.self-challenge-solution {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.route-info {
    color: #666;
    font-size: 0.9em;
    margin-bottom: 10px;
}

.description {
    color: #2c3e50;
    margin-bottom: 30px;
    font-size: 1.1em;
}

.task-status {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 30px;
    border-left: 4px solid #28a745;
}

.completed-tasks {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 15px;
}

.task-badge {
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.9em;
    font-weight: 500;
}

.task-badge.completed {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.demo-section {
    display: grid;
    gap: 20px;
}

.demo-card {
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s;
}

.demo-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

.demo-card h4 {
    color: #495057;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid #e9ecef;
}

.demo-content {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.user-profile,
.user-settings,
.user-stats {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid #007bff;
}

.controls {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
    margin-top: 15px;
}

.controls input,
.controls select {
    padding: 8px 12px;
    border: 1px solid #ced4da;
    border-radius: 5px;
    font-size: 0.9em;
}

.controls button {
    padding: 8px 16px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.2s;
}

.controls button:hover {
    background: #0056b3;
}

.display-name {
    font-size: 1.3em;
    font-weight: bold;
    color: #495057;
    text-align: center;
    padding: 15px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 10px;
}

.message {
    padding: 10px 15px;
    background: #d1ecf1;
    color: #0c5460;
    border: 1px solid #bee5eb;
    border-radius: 5px;
    margin-top: 10px;
}

ul {
    list-style: none;
    padding: 0;
}

li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    background: #f8f9fa;
    margin-bottom: 5px;
    border-radius: 5px;
}

li button {
    background: #dc3545;
    color: white;
    border: none;
    padding: 4px 8px;
    border-radius: 3px;
    cursor: pointer;
    font-size: 0.8em;
}

li button:hover {
    background: #c82333;
}

@media (max-width: 768px) {
    .controls {
        flex-direction: column;
        align-items: stretch;
    }

    .completed-tasks {
        flex-direction: column;
    }
}
</style>
