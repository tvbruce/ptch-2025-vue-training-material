<template>
  <div class="answering-area">
    <h2>ğŸ¯ åƒè€ƒç­”æ¡ˆ - è¡¨å–®è¼¸å…¥èˆ‡ v-model</h2>
    <p class="description">
      ğŸ“ <strong>ä»»å‹™ï¼š</strong>å»ºç«‹ä¸€å€‹å®Œæ•´çš„ä½¿ç”¨è€…è¨»å†Šç³»çµ±ï¼Œå¯¦ä½œå„ç¨®è¡¨å–®æ§åˆ¶å…ƒä»¶å’Œé©—è­‰
    </p>

    <!-- ä»»å‹™ä¸€ï¼šåŸºæœ¬è³‡æ–™è¡¨å–® -->
    <div class="task-section">
      <h3>ğŸ‘¤ ä»»å‹™ä¸€ï¼šåŸºæœ¬è³‡æ–™</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>ğŸ‘¤ ä½¿ç”¨è€…åç¨±ï¼š</label>
          <input v-model="formData.username" type="text" placeholder="è«‹è¼¸å…¥ä½¿ç”¨è€…åç¨±" class="form-input"
            :class="{ 'error': errors.username }">
          <span v-if="errors.username" class="error-text">{{ errors.username }}</span>
        </div>

        <div class="form-group">
          <label>ğŸ“§ é›»å­éƒµä»¶ï¼š</label>
          <input v-model="formData.email" type="email" placeholder="è«‹è¼¸å…¥é›»å­éƒµä»¶" class="form-input"
            :class="{ 'error': errors.email }">
          <span v-if="errors.email" class="error-text">{{ errors.email }}</span>
        </div>

        <div class="form-group">
          <label>ğŸ”’ å¯†ç¢¼ï¼š</label>
          <input v-model="formData.password" type="password" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" class="form-input"
            :class="{ 'error': errors.password }">
          <span v-if="errors.password" class="error-text">{{ errors.password }}</span>
        </div>

        <div class="form-group">
          <label>ğŸ”’ ç¢ºèªå¯†ç¢¼ï¼š</label>
          <input v-model="formData.confirmPassword" type="password" placeholder="è«‹å†æ¬¡è¼¸å…¥å¯†ç¢¼" class="form-input"
            :class="{ 'error': errors.confirmPassword }">
          <span v-if="errors.confirmPassword" class="error-text">{{ errors.confirmPassword }}</span>
        </div>
      </div>
    </div>

    <!-- ä»»å‹™äºŒï¼šå€‹äººè³‡è¨Š -->
    <div class="task-section">
      <h3>ğŸ“ ä»»å‹™äºŒï¼šå€‹äººè³‡è¨Š</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>ğŸ‚ å¹´é½¡ï¼š</label>
          <input v-model.number="formData.age" type="number" placeholder="è«‹è¼¸å…¥å¹´é½¡" class="form-input" min="0" max="120">
        </div>

        <div class="form-group">
          <label>ğŸ‘« æ€§åˆ¥ï¼š</label>
          <div class="radio-group">
            <label class="radio-item">
              <input v-model="formData.gender" type="radio" value="male">
              <span>ç”·æ€§</span>
            </label>
            <label class="radio-item">
              <input v-model="formData.gender" type="radio" value="female">
              <span>å¥³æ€§</span>
            </label>
            <label class="radio-item">
              <input v-model="formData.gender" type="radio" value="other">
              <span>å…¶ä»–</span>
            </label>
          </div>
        </div>

        <div class="form-group">
          <label>ğŸ  å±…ä½åŸå¸‚ï¼š</label>
          <select v-model="formData.city" class="form-select">
            <option value="">è«‹é¸æ“‡åŸå¸‚</option>
            <option value="taipei">å°åŒ—å¸‚</option>
            <option value="taichung">å°ä¸­å¸‚</option>
            <option value="kaohsiung">é«˜é›„å¸‚</option>
            <option value="tainan">å°å—å¸‚</option>
            <option value="taoyuan">æ¡ƒåœ’å¸‚</option>
          </select>
        </div>

        <div class="form-group full-width">
          <label>ğŸ’¡ èˆˆè¶£æ„›å¥½ï¼š</label>
          <div class="checkbox-group">
            <label class="checkbox-item">
              <input v-model="formData.hobbies" type="checkbox" value="reading">
              <span>é–±è®€</span>
            </label>
            <label class="checkbox-item">
              <input v-model="formData.hobbies" type="checkbox" value="music">
              <span>éŸ³æ¨‚</span>
            </label>
            <label class="checkbox-item">
              <input v-model="formData.hobbies" type="checkbox" value="sports">
              <span>é‹å‹•</span>
            </label>
            <label class="checkbox-item">
              <input v-model="formData.hobbies" type="checkbox" value="travel">
              <span>æ—…éŠ</span>
            </label>
            <label class="checkbox-item">
              <input v-model="formData.hobbies" type="checkbox" value="cooking">
              <span>çƒ¹é£ª</span>
            </label>
            <label class="checkbox-item">
              <input v-model="formData.hobbies" type="checkbox" value="photography">
              <span>æ”å½±</span>
            </label>
          </div>
        </div>

        <div class="form-group full-width">
          <label>ğŸ“ è‡ªæˆ‘ä»‹ç´¹ï¼š</label>
          <textarea v-model="formData.bio" placeholder="è«‹ç°¡å–®ä»‹ç´¹ä¸€ä¸‹è‡ªå·±..." class="form-textarea" rows="4"
            maxlength="500"></textarea>
          <div class="char-count" :class="{ 'warning': formData.bio.length > 400 }">
            {{ formData.bio.length }} / 500 å­—
          </div>
        </div>
      </div>
    </div>

    <!-- ä»»å‹™ä¸‰ï¼šè¨­å®šé¸é … -->
    <div class="task-section">
      <h3>âš™ï¸ ä»»å‹™ä¸‰ï¼šå¸³è™Ÿè¨­å®š</h3>
      <div class="form-grid">
        <div class="form-group">
          <label class="checkbox-item">
            <input v-model="formData.agreeTerms" type="checkbox">
            <span>æˆ‘åŒæ„æœå‹™æ¢æ¬¾èˆ‡éš±ç§æ”¿ç­–</span>
          </label>
        </div>

        <div class="form-group">
          <label class="checkbox-item">
            <input v-model="formData.newsletter" type="checkbox">
            <span>è¨‚é–±é›»å­å ±</span>
          </label>
        </div>

        <div class="form-group">
          <label class="checkbox-item">
            <input v-model="formData.notifications" type="checkbox">
            <span>æ¥æ”¶æ¨æ’­é€šçŸ¥</span>
          </label>
        </div>
      </div>
    </div>

    <!-- ä»»å‹™å››ï¼šè¡¨å–®æ§åˆ¶ -->
    <div class="task-section">
      <h3>ğŸ›ï¸ ä»»å‹™å››ï¼šè¡¨å–®æ“ä½œ</h3>
      <div class="form-actions">
        <button @click="validateForm" class="btn btn-primary">é©—è­‰è¡¨å–®</button>
        <button @click="submitForm" :disabled="!isFormValid" class="btn btn-success">æäº¤è¨»å†Š</button>
        <button @click="resetForm" class="btn btn-secondary">é‡ç½®è¡¨å–®</button>
        <button @click="fillSampleData" class="btn btn-info">å¡«å…¥ç¯„ä¾‹è³‡æ–™</button>
      </div>

      <div v-if="submitMessage" class="submit-message" :class="submitStatus">
        {{ submitMessage }}
      </div>
    </div>

    <!-- ä»»å‹™äº”ï¼šè³‡æ–™é è¦½ -->
    <div class="task-section">
      <h3>ğŸ‘ï¸ ä»»å‹™äº”ï¼šå³æ™‚é è¦½</h3>
      <div class="preview-container">
        <h4>ç›®å‰è¡¨å–®è³‡æ–™ï¼š</h4>
        <pre class="data-preview">{{ formDataPreview }}</pre>

        <h4>é©—è­‰ç‹€æ…‹ï¼š</h4>
        <div class="validation-status">
          <div class="status-item" :class="{ 'valid': !errors.username, 'invalid': errors.username }">
            ä½¿ç”¨è€…åç¨±ï¼š{{ !errors.username ? 'âœ… æœ‰æ•ˆ' : 'âŒ ç„¡æ•ˆ' }}
          </div>
          <div class="status-item" :class="{ 'valid': !errors.email, 'invalid': errors.email }">
            é›»å­éƒµä»¶ï¼š{{ !errors.email ? 'âœ… æœ‰æ•ˆ' : 'âŒ ç„¡æ•ˆ' }}
          </div>
          <div class="status-item" :class="{ 'valid': !errors.password, 'invalid': errors.password }">
            å¯†ç¢¼ï¼š{{ !errors.password ? 'âœ… æœ‰æ•ˆ' : 'âŒ ç„¡æ•ˆ' }}
          </div>
          <div class="status-item" :class="{ 'valid': !errors.confirmPassword, 'invalid': errors.confirmPassword }">
            ç¢ºèªå¯†ç¢¼ï¼š{{ !errors.confirmPassword ? 'âœ… æœ‰æ•ˆ' : 'âŒ ç„¡æ•ˆ' }}
          </div>
        </div>
      </div>
    </div>

    <!-- é–‹ç™¼æç¤º -->
    <div class="hint-section">
      <h4>ğŸ’¡ é–‹ç™¼æç¤º</h4>
      <ul>
        <li>v-model åŸºæœ¬ç”¨æ³•ï¼šç¶å®š input, textarea, select ç­‰è¡¨å–®å…ƒç´ </li>
        <li>v-model ä¿®é£¾ç¬¦ï¼š.numberï¼ˆæ•¸å­—ï¼‰ï¼Œ.trimï¼ˆå»ç©ºæ ¼ï¼‰ï¼Œ.lazyï¼ˆå¤±ç„¦æ™‚æ›´æ–°ï¼‰</li>
        <li>è¡¨å–®é©—è­‰ï¼šå¯¦ä½œå³æ™‚é©—è­‰å’Œæäº¤å‰é©—è­‰</li>
        <li>checkbox é™£åˆ—ï¼šå¤šé¸æ¡†å¯ä»¥ç¶å®šåˆ°é™£åˆ—</li>
        <li>computed è¨ˆç®—å±¬æ€§ï¼šç”¨æ–¼è¡¨å–®ç‹€æ…‹è¨ˆç®—å’Œè³‡æ–™æ ¼å¼åŒ–</li>
      </ul>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, watch } from 'vue'

// è¡¨å–®è³‡æ–™
const formData = ref({
  username: '',
  email: '',
  password: '',
  confirmPassword: '',
  age: null,
  gender: '',
  city: '',
  hobbies: [],
  bio: '',
  agreeTerms: false,
  newsletter: false,
  notifications: false
})

// éŒ¯èª¤ç‹€æ…‹
const errors = ref({
  username: '',
  email: '',
  password: '',
  confirmPassword: ''
})

// æäº¤ç‹€æ…‹
const submitMessage = ref('')
const submitStatus = ref('')

// ä½¿ç”¨è€…åç¨±é©—è­‰
const validateUsername = () => {
  const username = formData.value.username.trim()

  if (!username) {
    errors.value.username = 'ä½¿ç”¨è€…åç¨±ä¸èƒ½ç‚ºç©º'
    return false
  }

  if (username.length < 3 || username.length > 20) {
    errors.value.username = 'ä½¿ç”¨è€…åç¨±å¿…é ˆåœ¨3-20å­—å…ƒä¹‹é–“'
    return false
  }

  const usernameRegex = /^[a-zA-Z0-9_]+$/
  if (!usernameRegex.test(username)) {
    errors.value.username = 'ä½¿ç”¨è€…åç¨±åªèƒ½åŒ…å«å­—æ¯ã€æ•¸å­—å’Œåº•ç·š'
    return false
  }

  errors.value.username = ''
  return true
}

// é›»å­éƒµä»¶é©—è­‰
const validateEmail = () => {
  const email = formData.value.email.trim()

  if (!email) {
    errors.value.email = 'é›»å­éƒµä»¶ä¸èƒ½ç‚ºç©º'
    return false
  }

  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
  if (!emailRegex.test(email)) {
    errors.value.email = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»å­éƒµä»¶æ ¼å¼'
    return false
  }

  errors.value.email = ''
  return true
}

// å¯†ç¢¼é©—è­‰
const validatePassword = () => {
  const password = formData.value.password

  if (!password) {
    errors.value.password = 'å¯†ç¢¼ä¸èƒ½ç‚ºç©º'
    return false
  }

  if (password.length < 8) {
    errors.value.password = 'å¯†ç¢¼è‡³å°‘éœ€è¦8å€‹å­—å…ƒ'
    return false
  }

  const hasUpperCase = /[A-Z]/.test(password)
  const hasLowerCase = /[a-z]/.test(password)
  const hasNumbers = /\d/.test(password)

  if (!hasUpperCase || !hasLowerCase || !hasNumbers) {
    errors.value.password = 'å¯†ç¢¼å¿…é ˆåŒ…å«å¤§å¯«å­—æ¯ã€å°å¯«å­—æ¯å’Œæ•¸å­—'
    return false
  }

  errors.value.password = ''
  return true
}

// ç¢ºèªå¯†ç¢¼é©—è­‰
const validateConfirmPassword = () => {
  const confirmPassword = formData.value.confirmPassword
  const password = formData.value.password

  if (!confirmPassword) {
    errors.value.confirmPassword = 'è«‹ç¢ºèªå¯†ç¢¼'
    return false
  }

  if (confirmPassword !== password) {
    errors.value.confirmPassword = 'å¯†ç¢¼ä¸ä¸€è‡´'
    return false
  }

  errors.value.confirmPassword = ''
  return true
}

// å®Œæ•´è¡¨å–®é©—è­‰
const validateForm = () => {
  const usernameValid = validateUsername()
  const emailValid = validateEmail()
  const passwordValid = validatePassword()
  const confirmPasswordValid = validateConfirmPassword()

  const isValid = usernameValid && emailValid && passwordValid && confirmPasswordValid

  if (isValid) {
    submitMessage.value = 'âœ… è¡¨å–®é©—è­‰é€šéï¼'
    submitStatus.value = 'success'
  } else {
    submitMessage.value = 'âŒ è¡¨å–®é©—è­‰å¤±æ•—ï¼Œè«‹æª¢æŸ¥éŒ¯èª¤é …ç›®'
    submitStatus.value = 'error'
  }

  // è‡ªå‹•æ¸…é™¤è¨Šæ¯
  setTimeout(() => {
    submitMessage.value = ''
    submitStatus.value = ''
  }, 3000)

  return isValid
}

// è¡¨å–®æœ‰æ•ˆæ€§æª¢æŸ¥
const isFormValid = computed(() => {
  return !errors.value.username &&
    !errors.value.email &&
    !errors.value.password &&
    !errors.value.confirmPassword &&
    formData.value.username.trim() &&
    formData.value.email.trim() &&
    formData.value.password &&
    formData.value.confirmPassword &&
    formData.value.agreeTerms
})

// è¡¨å–®è³‡æ–™é è¦½
const formDataPreview = computed(() => {
  return JSON.stringify({
    username: formData.value.username,
    email: formData.value.email,
    password: '***éš±è—***',
    age: formData.value.age,
    gender: formData.value.gender,
    city: formData.value.city,
    hobbies: formData.value.hobbies,
    bio: formData.value.bio.substring(0, 50) + (formData.value.bio.length > 50 ? '...' : ''),
    agreeTerms: formData.value.agreeTerms,
    newsletter: formData.value.newsletter,
    notifications: formData.value.notifications
  }, null, 2)
})

// æäº¤è¡¨å–®
const submitForm = async () => {
  if (!validateForm()) {
    return
  }

  try {
    submitMessage.value = 'æäº¤ä¸­...'
    submitStatus.value = 'info'

    // æ¨¡æ“¬ API æäº¤
    await new Promise(resolve => setTimeout(resolve, 2000))

    // éš¨æ©Ÿæ±ºå®šæˆåŠŸæˆ–å¤±æ•—ï¼ˆ90% æˆåŠŸç‡ï¼‰
    if (Math.random() > 0.1) {
      submitMessage.value = 'ğŸ‰ è¨»å†ŠæˆåŠŸï¼æ­¡è¿åŠ å…¥æˆ‘å€‘ï¼'
      submitStatus.value = 'success'

      // æˆåŠŸå¾Œé‡ç½®è¡¨å–®
      setTimeout(() => {
        resetForm()
      }, 2000)
    } else {
      throw new Error('ä¼ºæœå™¨æš«æ™‚ç„¡æ³•è™•ç†è«‹æ±‚')
    }

  } catch (error) {
    submitMessage.value = `âŒ è¨»å†Šå¤±æ•—ï¼š${error.message}`
    submitStatus.value = 'error'
  }
}

// é‡ç½®è¡¨å–®
const resetForm = () => {
  formData.value = {
    username: '',
    email: '',
    password: '',
    confirmPassword: '',
    age: null,
    gender: '',
    city: '',
    hobbies: [],
    bio: '',
    agreeTerms: false,
    newsletter: false,
    notifications: false
  }

  errors.value = {
    username: '',
    email: '',
    password: '',
    confirmPassword: ''
  }

  submitMessage.value = 'è¡¨å–®å·²é‡ç½®'
  submitStatus.value = 'success'

  setTimeout(() => {
    submitMessage.value = ''
    submitStatus.value = ''
  }, 2000)
}

// å¡«å…¥ç¯„ä¾‹è³‡æ–™
const fillSampleData = () => {
  formData.value = {
    username: 'john_doe',
    email: 'john.doe@example.com',
    password: 'Password123',
    confirmPassword: 'Password123',
    age: 25,
    gender: 'male',
    city: 'taipei',
    hobbies: ['reading', 'music', 'travel'],
    bio: 'æˆ‘æ˜¯ä¸€åè»Ÿé«”å·¥ç¨‹å¸«ï¼Œç†±æ„›ç¨‹å¼è¨­è¨ˆå’Œæ–°æŠ€è¡“å­¸ç¿’ã€‚',
    agreeTerms: true,
    newsletter: true,
    notifications: false
  }

  // è§¸ç™¼é©—è­‰
  validateForm()
}

// ç›£è½å™¨ï¼šå³æ™‚é©—è­‰
watch(() => formData.value.username, () => {
  if (formData.value.username.trim()) {
    validateUsername()
  } else {
    errors.value.username = ''
  }
})

watch(() => formData.value.email, () => {
  if (formData.value.email.trim()) {
    validateEmail()
  } else {
    errors.value.email = ''
  }
})

watch(() => formData.value.password, () => {
  if (formData.value.password) {
    validatePassword()
    // å¦‚æœç¢ºèªå¯†ç¢¼å·²ç¶“å¡«å¯«ï¼Œä¹Ÿè¦é‡æ–°é©—è­‰
    if (formData.value.confirmPassword) {
      validateConfirmPassword()
    }
  } else {
    errors.value.password = ''
  }
})

watch(() => formData.value.confirmPassword, () => {
  if (formData.value.confirmPassword) {
    validateConfirmPassword()
  } else {
    errors.value.confirmPassword = ''
  }
})
</script>

<style scoped>
.answering-area {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

.task-section {
  background: #f8f9fa;
  padding: 2rem;
  border-radius: 8px;
  margin: 2rem 0;
  border-left: 4px solid #fd7e14;
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.form-group.full-width {
  grid-column: 1 / -1;
}

.form-group label {
  font-weight: bold;
  color: #495057;
}

.form-input,
.form-select,
.form-textarea {
  padding: 0.75rem;
  border: 2px solid #dee2e6;
  border-radius: 4px;
  font-size: 1rem;
  transition: border-color 0.3s ease;
}

.form-input:focus,
.form-select:focus,
.form-textarea:focus {
  outline: none;
  border-color: #fd7e14;
}

.form-input.error,
.form-select.error,
.form-textarea.error {
  border-color: #dc3545;
}

.error-text {
  color: #dc3545;
  font-size: 0.875rem;
  margin-top: 0.25rem;
}

.radio-group,
.checkbox-group {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
}

.radio-item,
.checkbox-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  cursor: pointer;
  font-weight: normal;
}

.radio-item input,
.checkbox-item input {
  margin: 0;
}

.char-count {
  font-size: 0.875rem;
  color: #6c757d;
  text-align: right;
}

.char-count.warning {
  color: #fd7e14;
  font-weight: bold;
}

.form-actions {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
}

.btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
  transition: all 0.3s ease;
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.btn-primary {
  background: #007bff;
  color: white;
}

.btn-primary:hover:not(:disabled) {
  background: #0056b3;
}

.btn-secondary {
  background: #6c757d;
  color: white;
}

.btn-secondary:hover:not(:disabled) {
  background: #545b62;
}

.btn-success {
  background: #28a745;
  color: white;
}

.btn-success:hover:not(:disabled) {
  background: #1e7e34;
}

.btn-info {
  background: #17a2b8;
  color: white;
}

.btn-info:hover:not(:disabled) {
  background: #117a8b;
}

.submit-message {
  margin-top: 1rem;
  padding: 1rem;
  border-radius: 4px;
  font-weight: bold;
  animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.submit-message.success {
  background: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}

.submit-message.error {
  background: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}

.submit-message.info {
  background: #d1ecf1;
  color: #0c5460;
  border: 1px solid #bee5eb;
}

.preview-container {
  background: white;
  padding: 1.5rem;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.data-preview {
  background: #f8f9fa;
  padding: 1rem;
  border-radius: 4px;
  border: 1px solid #dee2e6;
  font-size: 0.875rem;
  overflow-x: auto;
  max-height: 300px;
  overflow-y: auto;
}

.validation-status {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-top: 1rem;
}

.status-item {
  padding: 0.5rem 1rem;
  border-radius: 4px;
  font-weight: bold;
  transition: all 0.3s ease;
}

.status-item.valid {
  background: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}

.status-item.invalid {
  background: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}

.hint-section {
  background: #fff3cd;
  padding: 1.5rem;
  border-radius: 8px;
  margin-top: 2rem;
  border-left: 4px solid #ffc107;
}

.hint-section ul {
  margin: 0.5rem 0;
  padding-left: 1.5rem;
}

.hint-section li {
  margin-bottom: 0.5rem;
}

@media (max-width: 768px) {
  .form-grid {
    grid-template-columns: 1fr;
  }

  .form-actions {
    flex-direction: column;
  }

  .validation-status {
    grid-template-columns: 1fr;
  }

  .radio-group,
  .checkbox-group {
    flex-direction: column;
    gap: 0.5rem;
  }
}
</style>
