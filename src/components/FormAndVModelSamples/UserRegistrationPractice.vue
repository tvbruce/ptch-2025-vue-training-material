<template>
  <div class="user-registration-practice">
    <h2>ğŸ“ ç”¨æˆ¶è¨»å†Šè¡¨å–® - v-model ç·´ç¿’</h2>
    <p class="route-info">ğŸ“ è·¯å¾‘ï¼š/FormAndVModelSamples/UserRegistrationPractice.vue</p>
    <p class="description">
      ğŸ“ <strong>ç·´ç¿’ç›®æ¨™ï¼š</strong>å­¸ç¿’ v-model åœ¨å„ç¨®è¡¨å–®å…ƒç´ ä¸­çš„ä½¿ç”¨ï¼ŒæŒæ¡é›™å‘æ•¸æ“šç¶å®š
    </p>

    <div class="demo-section">
      <h3>ğŸ¯ ç·´ç¿’ä»»å‹™</h3>
      <div class="task-list">
        <div class="task-item">
          <span>âœ… 1. æ–‡æœ¬è¼¸å…¥èˆ‡ v-model</span>
        </div>
        <div class="task-item">
          <span>âœ… 2. å–®é¸æŒ‰éˆ•èˆ‡ v-model</span>
        </div>
        <div class="task-item">
          <span>âœ… 3. å¤šé¸æ¡†èˆ‡ v-model</span>
        </div>
        <div class="task-item">
          <span>âœ… 4. ä¸‹æ‹‰é¸å–®èˆ‡ v-model</span>
        </div>
        <div class="task-item">
          <span>âœ… 5. è¡¨å–®é©—è­‰èˆ‡å³æ™‚åé¥‹</span>
        </div>
      </div>
    </div>

    <div class="demo-section">
      <h3>ğŸ‘¤ è¨»å†Šè¡¨å–®</h3>
      <form @submit.prevent="handleSubmit" class="registration-form">
        <!-- åŸºæœ¬è³‡è¨Š -->
        <div class="form-section">
          <h4>åŸºæœ¬è³‡è¨Š</h4>
          <div class="form-row">
            <div class="form-group">
              <label for="username">ç”¨æˆ¶å *</label>
              <input id="username" v-model="form.username" type="text" class="input-field"
                :class="{ 'error': errors.username }" placeholder="è«‹è¼¸å…¥ç”¨æˆ¶å" @blur="validateUsername">
              <div v-if="errors.username" class="error-message">
                {{ errors.username }}
              </div>
            </div>
            <div class="form-group">
              <label for="email">é›»å­éƒµç®± *</label>
              <input id="email" v-model="form.email" type="email" class="input-field" :class="{ 'error': errors.email }"
                placeholder="example@email.com" @blur="validateEmail">
              <div v-if="errors.email" class="error-message">
                {{ errors.email }}
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="password">å¯†ç¢¼ *</label>
              <input id="password" v-model="form.password" type="password" class="input-field"
                :class="{ 'error': errors.password }" placeholder="è‡³å°‘ 6 å€‹å­—ç¬¦" @input="validatePassword">
              <div class="password-strength">
                <div class="strength-bar">
                  <div class="strength-fill" :class="passwordStrength.class"
                    :style="{ width: passwordStrength.width + '%' }"></div>
                </div>
                <span class="strength-text">{{ passwordStrength.text }}</span>
              </div>
              <div v-if="errors.password" class="error-message">
                {{ errors.password }}
              </div>
            </div>
            <div class="form-group">
              <label for="confirmPassword">ç¢ºèªå¯†ç¢¼ *</label>
              <input id="confirmPassword" v-model="form.confirmPassword" type="password" class="input-field"
                :class="{ 'error': errors.confirmPassword }" placeholder="å†æ¬¡è¼¸å…¥å¯†ç¢¼" @blur="validateConfirmPassword">
              <div v-if="errors.confirmPassword" class="error-message">
                {{ errors.confirmPassword }}
              </div>
            </div>
          </div>
        </div>

        <!-- å€‹äººè³‡è¨Š -->
        <div class="form-section">
          <h4>å€‹äººè³‡è¨Š</h4>
          <div class="form-row">
            <div class="form-group">
              <label>æ€§åˆ¥</label>
              <div class="radio-group">
                <label class="radio-label">
                  <input v-model="form.gender" type="radio" value="male">
                  <span>ç”·æ€§</span>
                </label>
                <label class="radio-label">
                  <input v-model="form.gender" type="radio" value="female">
                  <span>å¥³æ€§</span>
                </label>
                <label class="radio-label">
                  <input v-model="form.gender" type="radio" value="other">
                  <span>å…¶ä»–</span>
                </label>
              </div>
            </div>
            <div class="form-group">
              <label for="birthDate">å‡ºç”Ÿæ—¥æœŸ</label>
              <input id="birthDate" v-model="form.birthDate" type="date" class="input-field">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="country">åœ‹å®¶/åœ°å€</label>
              <select id="country" v-model="form.country" class="select-field">
                <option value="">è«‹é¸æ“‡åœ‹å®¶</option>
                <option value="taiwan">å°ç£</option>
                <option value="china">ä¸­åœ‹</option>
                <option value="hongkong">é¦™æ¸¯</option>
                <option value="singapore">æ–°åŠ å¡</option>
                <option value="japan">æ—¥æœ¬</option>
                <option value="korea">éŸ“åœ‹</option>
                <option value="usa">ç¾åœ‹</option>
                <option value="other">å…¶ä»–</option>
              </select>
            </div>
            <div class="form-group">
              <label for="occupation">è·æ¥­</label>
              <select id="occupation" v-model="form.occupation" class="select-field">
                <option value="">è«‹é¸æ“‡è·æ¥­</option>
                <option value="student">å­¸ç”Ÿ</option>
                <option value="engineer">å·¥ç¨‹å¸«</option>
                <option value="designer">è¨­è¨ˆå¸«</option>
                <option value="teacher">æ•™å¸«</option>
                <option value="doctor">é†«ç”Ÿ</option>
                <option value="business">å•†æ¥­äººå£«</option>
                <option value="other">å…¶ä»–</option>
              </select>
            </div>
          </div>
        </div>

        <!-- èˆˆè¶£æ„›å¥½ -->
        <div class="form-section">
          <h4>èˆˆè¶£æ„›å¥½ (å¯å¤šé¸)</h4>
          <div class="checkbox-group">
            <label v-for="hobby in hobbiesList" :key="hobby.value" class="checkbox-label">
              <input v-model="form.hobbies" type="checkbox" :value="hobby.value">
              <span>{{ hobby.label }}</span>
            </label>
          </div>
        </div>

        <!-- å…¶ä»–è¨­å®š -->
        <div class="form-section">
          <h4>å…¶ä»–è¨­å®š</h4>
          <div class="form-group">
            <label for="bio">å€‹äººç°¡ä»‹</label>
            <textarea id="bio" v-model="form.bio" class="textarea-field" placeholder="ç°¡å–®ä»‹ç´¹ä¸€ä¸‹è‡ªå·±..." rows="4"></textarea>
            <div class="char-count">
              {{ form.bio.length }}/500 å­—ç¬¦
            </div>
          </div>

          <div class="checkbox-group">
            <label class="checkbox-label">
              <input v-model="form.newsletter" type="checkbox">
              <span>è¨‚é–±é›»å­å ±</span>
            </label>
            <label class="checkbox-label">
              <input v-model="form.terms" type="checkbox">
              <span>æˆ‘åŒæ„ <a href="#" @click.prevent>æœå‹™æ¢æ¬¾</a> *</span>
            </label>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary btn-large" :disabled="!isFormValid">
            è¨»å†Š
          </button>
          <button type="button" @click="resetForm" class="btn btn-secondary btn-large">
            é‡ç½®
          </button>
        </div>
      </form>
    </div>

    <!-- é è¦½å€åŸŸ -->
    <div class="demo-section">
      <h3>ğŸ‘ï¸ è¡¨å–®æ•¸æ“šé è¦½</h3>
      <div class="form-preview">
        <pre>{{ JSON.stringify(form, null, 2) }}</pre>
      </div>
    </div>

    <div class="code-example">
      <h4>ğŸ’» é—œéµä»£ç¢¼</h4>
      <pre v-pre><code>// åŸºæœ¬ v-model ç”¨æ³•
&lt;input v-model="form.username" type="text"&gt;

// å–®é¸æŒ‰éˆ•
&lt;input v-model="form.gender" type="radio" value="male"&gt;
&lt;input v-model="form.gender" type="radio" value="female"&gt;

// å¤šé¸æ¡†
&lt;input v-model="form.hobbies" type="checkbox" value="reading"&gt;
&lt;input v-model="form.hobbies" type="checkbox" value="sports"&gt;

// ä¸‹æ‹‰é¸å–®
&lt;select v-model="form.country"&gt;
  &lt;option value="taiwan"&gt;å°ç£&lt;/option&gt;
  &lt;option value="china"&gt;ä¸­åœ‹&lt;/option&gt;
&lt;/select&gt;

// æ–‡æœ¬åŸŸ
&lt;textarea v-model="form.bio"&gt;&lt;/textarea&gt;

// éŸ¿æ‡‰å¼æ•¸æ“š
const form = ref({
  username: '',
  email: '',
  gender: '',
  hobbies: [],
  country: '',
  bio: ''
})</code></pre>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'

// è¡¨å–®æ•¸æ“š
const form = ref({
  username: '',
  email: '',
  password: '',
  confirmPassword: '',
  gender: '',
  birthDate: '',
  country: '',
  occupation: '',
  hobbies: [],
  bio: '',
  newsletter: false,
  terms: false
})

// éŒ¯èª¤ç‹€æ…‹
const errors = ref({
  username: '',
  email: '',
  password: '',
  confirmPassword: ''
})

// èˆˆè¶£åˆ—è¡¨
const hobbiesList = [
  { value: 'reading', label: 'ğŸ“š é–±è®€' },
  { value: 'sports', label: 'âš½ é‹å‹•' },
  { value: 'music', label: 'ğŸµ éŸ³æ¨‚' },
  { value: 'travel', label: 'âœˆï¸ æ—…è¡Œ' },
  { value: 'gaming', label: 'ğŸ® éŠæˆ²' },
  { value: 'cooking', label: 'ğŸ³ çƒ¹é£ª' },
  { value: 'photography', label: 'ğŸ“· æ”å½±' },
  { value: 'art', label: 'ğŸ¨ è—è¡“' }
]

// å¯†ç¢¼å¼·åº¦è¨ˆç®—
const passwordStrength = computed(() => {
  const password = form.value.password
  let score = 0

  if (password.length >= 6) score += 1
  if (password.length >= 8) score += 1
  if (/[A-Z]/.test(password)) score += 1
  if (/[0-9]/.test(password)) score += 1
  if (/[^A-Za-z0-9]/.test(password)) score += 1

  switch (score) {
    case 0:
    case 1:
      return { width: 20, class: 'weak', text: 'å¼±' }
    case 2:
      return { width: 40, class: 'fair', text: 'ä¸€èˆ¬' }
    case 3:
      return { width: 60, class: 'good', text: 'è‰¯å¥½' }
    case 4:
      return { width: 80, class: 'strong', text: 'å¼·' }
    case 5:
      return { width: 100, class: 'very-strong', text: 'å¾ˆå¼·' }
    default:
      return { width: 0, class: '', text: '' }
  }
})

// è¡¨å–®é©—è­‰
const isFormValid = computed(() => {
  return form.value.username.trim() !== '' &&
    form.value.email.trim() !== '' &&
    form.value.password.length >= 6 &&
    form.value.password === form.value.confirmPassword &&
    form.value.terms &&
    !Object.values(errors.value).some(error => error !== '')
})

// é©—è­‰å‡½æ•¸
const validateUsername = () => {
  if (!form.value.username.trim()) {
    errors.value.username = 'ç”¨æˆ¶åä¸èƒ½ç‚ºç©º'
  } else if (form.value.username.length < 3) {
    errors.value.username = 'ç”¨æˆ¶åè‡³å°‘éœ€è¦ 3 å€‹å­—ç¬¦'
  } else {
    errors.value.username = ''
  }
}

const validateEmail = () => {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
  if (!form.value.email.trim()) {
    errors.value.email = 'é›»å­éƒµç®±ä¸èƒ½ç‚ºç©º'
  } else if (!emailRegex.test(form.value.email)) {
    errors.value.email = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»å­éƒµç®±'
  } else {
    errors.value.email = ''
  }
}

const validatePassword = () => {
  if (form.value.password.length < 6) {
    errors.value.password = 'å¯†ç¢¼è‡³å°‘éœ€è¦ 6 å€‹å­—ç¬¦'
  } else {
    errors.value.password = ''
  }
  // åŒæ™‚é©—è­‰ç¢ºèªå¯†ç¢¼
  validateConfirmPassword()
}

const validateConfirmPassword = () => {
  if (form.value.confirmPassword !== form.value.password) {
    errors.value.confirmPassword = 'å…©æ¬¡è¼¸å…¥çš„å¯†ç¢¼ä¸ä¸€è‡´'
  } else {
    errors.value.confirmPassword = ''
  }
}

// æäº¤è™•ç†
const handleSubmit = () => {
  // åŸ·è¡Œæ‰€æœ‰é©—è­‰
  validateUsername()
  validateEmail()
  validatePassword()
  validateConfirmPassword()

  if (isFormValid.value) {
    alert('è¨»å†ŠæˆåŠŸï¼\n\næŸ¥çœ‹æ§åˆ¶å°äº†è§£æäº¤çš„æ•¸æ“š')
    console.log('æäº¤çš„è¡¨å–®æ•¸æ“šï¼š', form.value)
  } else {
    alert('è«‹æª¢æŸ¥è¡¨å–®ä¸­çš„éŒ¯èª¤ä¿¡æ¯')
  }
}

// é‡ç½®è¡¨å–®
const resetForm = () => {
  form.value = {
    username: '',
    email: '',
    password: '',
    confirmPassword: '',
    gender: '',
    birthDate: '',
    country: '',
    occupation: '',
    hobbies: [],
    bio: '',
    newsletter: false,
    terms: false
  }

  errors.value = {
    username: '',
    email: '',
    password: '',
    confirmPassword: ''
  }
}
</script>
