<!-- components/FormAndVModelSamples/ModifiersDemo.vue -->
<template>
    <div class="modifiers-demo">
        <h2>v-model ä¿®é£¾ç¬¦</h2>
        <p class="route-info">ğŸ“ è·¯å¾‘ï¼š/FormAndVModelSamples/ModifiersDemo.vue</p>

        <!-- .lazy ä¿®é£¾ç¬¦ -->
        <div class="demo-section">
            <h3>1. .lazy ä¿®é£¾ç¬¦</h3>
            <p class="description">é è¨­æƒ…æ³ä¸‹ï¼Œv-model åœ¨æ¯æ¬¡ input äº‹ä»¶å¾ŒåŒæ­¥æ•¸æ“šã€‚åŠ ä¸Š .lazy ä¿®é£¾ç¬¦å¾Œï¼Œæœƒæ”¹ç‚ºåœ¨ change äº‹ä»¶å¾ŒåŒæ­¥ã€‚</p>

            <div class="demo-grid">
                <div class="demo-item">
                    <label>é è¨­è¡Œç‚º (å³æ™‚åŒæ­¥)ï¼š</label>
                    <input type="text" v-model="normalInput" placeholder="è¼¸å…¥æ–‡å­—è©¦è©¦">
                    <div class="output">å³æ™‚å€¼ï¼š{{ normalInput }}</div>
                    <div class="update-count">æ›´æ–°æ¬¡æ•¸ï¼š{{ normalUpdateCount }}</div>
                </div>

                <div class="demo-item">
                    <label>ä½¿ç”¨ .lazy (å¤±å»ç„¦é»æ™‚åŒæ­¥)ï¼š</label>
                    <input type="text" v-model.lazy="lazyInput" placeholder="è¼¸å…¥æ–‡å­—ç„¶å¾Œå¤±å»ç„¦é»">
                    <div class="output">åŒæ­¥å€¼ï¼š{{ lazyInput }}</div>
                    <div class="update-count">æ›´æ–°æ¬¡æ•¸ï¼š{{ lazyUpdateCount }}</div>
                </div>
            </div>

            <div class="input-comparison">
                <div class="calculation">
                    <strong>æ•ˆèƒ½å·®ç•°ï¼š</strong>
                    å³æ™‚æ›´æ–°äº† {{ normalUpdateCount }} æ¬¡ï¼Œå»¶é²æ›´æ–°äº† {{ lazyUpdateCount }} æ¬¡
                    <span v-if="normalUpdateCount > lazyUpdateCount">
                        (ç¯€çœäº† {{ normalUpdateCount - lazyUpdateCount }} æ¬¡æ›´æ–°)
                    </span>
                </div>
            </div>

            <div class="code-example">
                <pre v-pre><code>&lt;!-- é è¨­è¡Œç‚ºï¼šæ¯æ¬¡è¼¸å…¥éƒ½è§¸ç™¼ --&gt;
&lt;input v-model="normalInput"&gt;

&lt;!-- .lazy ä¿®é£¾ç¬¦ï¼šå¤±å»ç„¦é»æˆ–æŒ‰ Enter æ™‚æ‰è§¸ç™¼ --&gt;
&lt;input v-model.lazy="lazyInput"&gt;

// é©ç”¨å ´æ™¯ï¼š
// - å¤§å‹è¡¨å–®æ¸›å°‘ä¸å¿…è¦çš„é©—è­‰
// - è¤‡é›œè¨ˆç®—çš„è¼¸å…¥æ¡†
// - å³æ™‚æœç´¢çš„å»¶é²è™•ç†</code></pre>
            </div>
        </div>

        <!-- .number ä¿®é£¾ç¬¦ -->
        <div class="demo-section">
            <h3>2. .number ä¿®é£¾ç¬¦</h3>
            <p class="description">è‡ªå‹•å°‡è¼¸å…¥å€¼è½‰æ›ç‚ºæ•¸å­—é¡å‹ã€‚å¦‚æœè¼¸å…¥çš„å€¼ç„¡æ³•è¢« parseFloat() è§£æï¼Œå‰‡æœƒè¿”å›åŸå§‹çš„å€¼ã€‚</p>

            <div class="demo-grid">
                <div class="demo-item">
                    <label>ä¸ä½¿ç”¨ .numberï¼š</label>
                    <input type="text" v-model="stringNumber" placeholder="è¼¸å…¥æ•¸å­—">
                    <div class="output">
                        <div>å€¼ï¼š{{ stringNumber }}</div>
                        <div>å‹åˆ¥ï¼š{{ typeof stringNumber }}</div>
                        <div class="type-badge">{{ typeof stringNumber }}</div>
                    </div>
                </div>

                <div class="demo-item">
                    <label>ä½¿ç”¨ .numberï¼š</label>
                    <input type="text" v-model.number="realNumber" placeholder="è¼¸å…¥æ•¸å­—">
                    <div class="output">
                        <div>å€¼ï¼š{{ realNumber }}</div>
                        <div>å‹åˆ¥ï¼š{{ typeof realNumber }}</div>
                        <div class="type-badge">{{ typeof realNumber }}</div>
                    </div>
                </div>
            </div>

            <div class="number-operations">
                <h4>æ•¸å­¸é‹ç®—ç¤ºä¾‹ï¼š</h4>
                <div class="calc-grid">
                    <div class="calc-item">
                        <label>æ•¸å­—A (.number)ï¼š</label>
                        <input type="text" v-model.number="numberA" placeholder="è¼¸å…¥æ•¸å­—">
                        <div class="result">å€¼ï¼š{{ numberA }} ({{ typeof numberA }})</div>
                    </div>
                    <div class="calc-item">
                        <label>æ•¸å­—B (.number)ï¼š</label>
                        <input type="text" v-model.number="numberB" placeholder="è¼¸å…¥æ•¸å­—">
                        <div class="result">å€¼ï¼š{{ numberB }} ({{ typeof numberB }})</div>
                    </div>
                </div>
                <p><strong>åŠ æ³•çµæœï¼š</strong> {{ calculationResult }}</p>
                <p><strong>èªªæ˜ï¼š</strong> {{ calculationExplanation }}</p>
            </div>

            <div class="code-example">
                <pre v-pre><code>&lt;!-- å­—ä¸²å‹åˆ¥ --&gt;
&lt;input v-model="stringNumber"&gt;
// stringNumber çš„å€¼æ˜¯ "123" (å­—ä¸²)

&lt;!-- æ•¸å­—å‹åˆ¥ --&gt;
&lt;input v-model.number="realNumber"&gt;
// realNumber çš„å€¼æ˜¯ 123 (æ•¸å­—)

// æ•¸å­¸é‹ç®—
"5" + "3" = "53" (å­—ä¸²æ‹¼æ¥)
5 + 3 = 8 (æ•¸å­¸åŠ æ³•)</code></pre>
            </div>
        </div>

        <!-- .trim ä¿®é£¾ç¬¦ -->
        <div class="demo-section">
            <h3>3. .trim ä¿®é£¾ç¬¦</h3>
            <p class="description">è‡ªå‹•éæ¿¾ç”¨æˆ¶è¼¸å…¥çš„é¦–å°¾ç©ºç™½å­—ç¬¦ã€‚</p>

            <div class="demo-grid">
                <div class="demo-item">
                    <label>ä¸ä½¿ç”¨ .trimï¼š</label>
                    <input type="text" v-model="untrimmedText" placeholder="è¼¸å…¥å‰å¾Œå¸¶ç©ºæ ¼çš„æ–‡å­—">
                    <div class="output">
                        <div>é•·åº¦ï¼š{{ untrimmedText.length }} å­—å…ƒ</div>
                        <div class="whitespace-visual">"<span>{{ untrimmedText }}</span>"</div>
                    </div>
                </div>

                <div class="demo-item">
                    <label>ä½¿ç”¨ .trimï¼š</label>
                    <input type="text" v-model.trim="trimmedText" placeholder="è¼¸å…¥å‰å¾Œå¸¶ç©ºæ ¼çš„æ–‡å­—">
                    <div class="output">
                        <div>é•·åº¦ï¼š{{ trimmedText.length }} å­—å…ƒ</div>
                        <div class="whitespace-visual">"<span>{{ trimmedText }}</span>"</div>
                    </div>
                </div>
            </div>

            <div class="trim-examples">
                <h4>å¸¸è¦‹æ‡‰ç”¨å ´æ™¯ï¼š</h4>
                <div class="scenario-grid">
                    <div class="scenario">
                        <label>ç”¨æˆ¶åç¨±ï¼š</label>
                        <input type="text" v-model.trim="username" placeholder="è«‹è¼¸å…¥ç”¨æˆ¶å">
                        <div class="validation"
                            :class="{ valid: isValidUsername, invalid: username && !isValidUsername }">
                            {{ username ? (isValidUsername ? 'âœ… æœ‰æ•ˆçš„ç”¨æˆ¶å' : 'âŒ ç”¨æˆ¶åä¸èƒ½åŒ…å«ç©ºæ ¼') : 'è«‹è¼¸å…¥ç”¨æˆ¶å' }}
                        </div>
                    </div>

                    <div class="scenario">
                        <label>éƒµä»¶åœ°å€ï¼š</label>
                        <input type="email" v-model.trim="email" placeholder="è«‹è¼¸å…¥éƒµä»¶åœ°å€">
                        <div class="validation" :class="{ valid: isValidEmail, invalid: email && !isValidEmail }">
                            {{ email ? (isValidEmail ? 'âœ… æœ‰æ•ˆçš„éƒµä»¶æ ¼å¼' : 'âŒ éƒµä»¶æ ¼å¼ä¸æ­£ç¢º') : 'è«‹è¼¸å…¥éƒµä»¶åœ°å€' }}
                        </div>
                    </div>
                </div>
            </div>

            <div class="code-example">
                <pre v-pre><code>&lt;!-- ä¸ä½¿ç”¨ .trim --&gt;
&lt;input v-model="untrimmedText"&gt;
// è¼¸å…¥ "  hello  " å¾—åˆ° "  hello  "

&lt;!-- ä½¿ç”¨ .trim --&gt;
&lt;input v-model.trim="trimmedText"&gt;
// è¼¸å…¥ "  hello  " å¾—åˆ° "hello"

// å¸¸ç”¨æ–¼ï¼šç”¨æˆ¶åã€å¯†ç¢¼ã€éƒµä»¶åœ°å€ç­‰ä¸æ‡‰è©²æœ‰é¦–å°¾ç©ºæ ¼çš„è¼¸å…¥</code></pre>
            </div>
        </div>

        <!-- çµ„åˆä½¿ç”¨ä¿®é£¾ç¬¦ -->
        <div class="demo-section">
            <h3>4. çµ„åˆä½¿ç”¨ä¿®é£¾ç¬¦</h3>
            <p class="description">å¤šå€‹ä¿®é£¾ç¬¦å¯ä»¥ä¸€èµ·ä½¿ç”¨ï¼Œè™•ç†é †åºç‚ºï¼štrim â†’ number â†’ lazyã€‚</p>

            <div class="combined-examples">
                <div class="example-group">
                    <h5>.trim.number çµ„åˆï¼š</h5>
                    <input type="text" v-model.trim.number="trimmedNumber" placeholder="è¼¸å…¥å¸¶ç©ºæ ¼çš„æ•¸å­—">
                    <div class="output">
                        <div>å€¼ï¼š{{ trimmedNumber }}</div>
                        <div>å‹åˆ¥ï¼š{{ typeof trimmedNumber }}</div>
                    </div>
                </div>

                <div class="example-group">
                    <h5>.lazy.trim.number çµ„åˆï¼š</h5>
                    <input type="text" v-model.lazy.trim.number="lazyTrimmedNumber" placeholder="å¤±å»ç„¦é»æ™‚è™•ç†">
                    <div class="output">
                        <div>å€¼ï¼š{{ lazyTrimmedNumber }}</div>
                        <div>å‹åˆ¥ï¼š{{ typeof lazyTrimmedNumber }}</div>
                    </div>
                </div>
            </div>

            <div class="processing-steps">
                <h4>è™•ç†æ­¥é©Ÿç¤ºä¾‹ï¼š</h4>
                <div class="step">
                    <span class="step-label">1. ç”¨æˆ¶è¼¸å…¥ï¼š</span> " 123.45 "
                </div>
                <div class="step">
                    <span class="step-label">2. .trim è™•ç†ï¼š</span> "123.45"
                </div>
                <div class="step">
                    <span class="step-label">3. .number è™•ç†ï¼š</span> 123.45
                </div>
                <div class="step">
                    <span class="step-label">4. æœ€çµ‚çµæœï¼š</span> 123.45 (number é¡å‹)
                </div>
            </div>

            <div class="code-example">
                <pre v-pre><code>&lt;!-- çµ„åˆä½¿ç”¨ä¿®é£¾ç¬¦ --&gt;
&lt;input v-model.trim.number="trimmedNumber"&gt;
&lt;input v-model.lazy.trim.number="lazyTrimmedNumber"&gt;

// è™•ç†é †åºï¼š
// 1. .trim - ç§»é™¤é¦–å°¾ç©ºæ ¼
// 2. .number - è½‰æ›ç‚ºæ•¸å­—
// 3. .lazy - å»¶é²è§¸ç™¼ (å¦‚æœæœ‰çš„è©±)</code></pre>
            </div>
        </div>

        <!-- æ•ˆèƒ½æ¸¬è©¦ -->
        <div class="demo-section">
            <h3>5. æ•ˆèƒ½æ¸¬è©¦èˆ‡æœ€ä½³å¯¦è¸</h3>
            <div class="performance-test">
                <h4>æ¸²æŸ“æ¬¡æ•¸æ¸¬è©¦ï¼š</h4>
                <div class="test-inputs">
                    <div class="test-group">
                        <label>ä¸€èˆ¬è¼¸å…¥æ¡†ï¼š</label>
                        <input type="text" v-model="performanceTest.normal" placeholder="è¼¸å…¥æ–‡å­—">
                        <div class="render-count">æ¸²æŸ“æ¬¡æ•¸ï¼š{{ performanceTest.normalRenderCount }}</div>
                    </div>

                    <div class="test-group">
                        <label>ä½¿ç”¨ .lazyï¼š</label>
                        <input type="text" v-model.lazy="performanceTest.lazy" placeholder="è¼¸å…¥æ–‡å­—">
                        <div class="render-count">æ¸²æŸ“æ¬¡æ•¸ï¼š{{ performanceTest.lazyRenderCount }}</div>
                    </div>
                </div>
            </div>

            <div class="best-practices">
                <h4>æœ€ä½³å¯¦è¸å»ºè­°ï¼š</h4>
                <div class="practice-grid">
                    <div class="practice-item good">
                        <h6>âœ… å»ºè­°ä½¿ç”¨</h6>
                        <ul>
                            <li>è¡¨å–®é©—è­‰ä½¿ç”¨ .lazy æ¸›å°‘ä¸å¿…è¦çš„æª¢æŸ¥</li>
                            <li>æ•¸å­—è¨ˆç®—ä½¿ç”¨ .number ç¢ºä¿é¡å‹æ­£ç¢º</li>
                            <li>ç”¨æˆ¶è³‡æ–™è¼¸å…¥ä½¿ç”¨ .trim æ¸…ç†ç©ºæ ¼</li>
                            <li>çµ„åˆä½¿ç”¨ä¿®é£¾ç¬¦æé«˜æ•¸æ“šå“è³ª</li>
                        </ul>
                    </div>

                    <div class="practice-item caution">
                        <h6>âš ï¸ æ³¨æ„äº‹é …</h6>
                        <ul>
                            <li>.number ç„¡æ³•è§£ææ™‚æœƒå›å‚³åŸå§‹å€¼</li>
                            <li>ä¿®é£¾ç¬¦é †åºæœƒå½±éŸ¿è™•ç†çµæœ</li>
                            <li>.lazy å¯èƒ½å½±éŸ¿ä½¿ç”¨è€…é«”é©—</li>
                            <li>éåº¦ä½¿ç”¨ä¿®é£¾ç¬¦å¯èƒ½å¢åŠ è¤‡é›œåº¦</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<script setup>
import { ref, computed, watch } from 'vue'

// .lazy ä¿®é£¾ç¬¦
const normalInput = ref('')
const lazyInput = ref('')
const normalUpdateCount = ref(0)
const lazyUpdateCount = ref(0)

// .number ä¿®é£¾ç¬¦
const stringNumber = ref('')
const realNumber = ref('')
const numberA = ref('')
const numberB = ref('')

// .trim ä¿®é£¾ç¬¦
const untrimmedText = ref('')
const trimmedText = ref('')
const username = ref('')
const email = ref('')

// çµ„åˆä¿®é£¾ç¬¦
const trimmedNumber = ref('')
const lazyTrimmedNumber = ref('')

// æ•ˆèƒ½æ¸¬è©¦
const performanceTest = ref({
    normal: '',
    lazy: '',
    normalRenderCount: 0,
    lazyRenderCount: 0
})

// ç›£è½å™¨è¨ˆç®—æ›´æ–°æ¬¡æ•¸
watch(normalInput, () => {
    normalUpdateCount.value++
}, { immediate: false })

watch(lazyInput, () => {
    lazyUpdateCount.value++
}, { immediate: false })

watch(() => performanceTest.value.normal, () => {
    performanceTest.value.normalRenderCount++
}, { immediate: false })

watch(() => performanceTest.value.lazy, () => {
    performanceTest.value.lazyRenderCount++
}, { immediate: false })

// è¨ˆç®—å±¬æ€§
const calculationResult = computed(() => {
    if (typeof numberA.value === 'number' && typeof numberB.value === 'number') {
        return numberA.value + numberB.value
    }
    return `${numberA.value}${numberB.value}`
})

const calculationExplanation = computed(() => {
    if (typeof numberA.value === 'number' && typeof numberB.value === 'number') {
        return 'æ•¸å­—ç›¸åŠ  (æ•¸å­¸é‹ç®—)'
    }
    return 'å­—ä¸²æ‹¼æ¥'
})

const isValidUsername = computed(() => {
    return username.value && !/\s/.test(username.value) && username.value.length >= 3
})

const isValidEmail = computed(() => {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
    return email.value && emailRegex.test(email.value)
})
</script>
